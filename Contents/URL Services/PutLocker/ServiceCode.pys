import re, urlparse, cgi, urllib, urllib2, cookielib, urlparsefrom BeautifulSoup import BeautifulSoupUSER_AGENT = 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_7_2) AppleWebKit/534.51.22 (KHTML, like Gecko) Version/5.1.1 Safari/534.51.22'	def MetadataObjectForURL(url): 	#Log('In MetadataObjectForURL for PutLocker / Sockshare (' + url + ')')		video = VideoClipObject(		title = 'PutLocker / Sockshare Redirect Page',		summary = 'PutLocker / Sockshare Redirect Page',		thumb = None,	)		return videodef MediaObjectsForURL(url):	cj = cookielib.CookieJar()	opener = urllib2.build_opener(urllib2.HTTPCookieProcessor(cj))		# Request LMWT this page.	#Log('Requesting ' + LMWT_URL + url)	request = urllib2.Request(url)	request.add_header('User-agent', USER_AGENT)		response = opener.open(request)		# Read in location and content of PutLocker page.	provider_url = response.geturl()	soup = BeautifulSoup(response.read())	#Log(provider_url)		if (provider_url.endswith('?404')):		Log('************** PROVIDER ERROR: Video no longer available (404 Returned)')		return []		# Read in form info...	params = {}	params['hash'] = soup.find('input', {'name' : 'hash' })['value']	params['confirm'] = "Continue as Free User"	#Log(params)		# Submit form by re-requesting the same page.	#Log('Requesting ' + url)	request = urllib2.Request(url)	request.add_header('User-agent', USER_AGENT)	request.add_data(urllib.urlencode(params))	response = opener.open(request)		# Read in data from response.	content = response.read()	#Log(content)		# Look for playlist URL.	playlist_res = re.search("playlist: \'(.*?)\'", content)		if (playlist_res is None):		Log('************** PROVIDER ERROR: Playlist element not found on video page.')		return []		playlist = playlist_res.group(1)	#Log(playlist)		putlocker_host = urlparse.urlparse(url).netloc		# Fetch playlist	#Log('Requesting ' + "http://" + putlocker_host + playlist)	request = urllib2.Request("http://" + putlocker_host + playlist)	request.add_header('User-agent', USER_AGENT)	response = opener.open(request)		final = response.read()	#Log(final)		final_url = re.search("<media:content url=\"(.*?)\"", final).group(1)	final_url += "?start=0"		# Add in a dummy referer as otherwise Leika adds in an empty Referer 	# which PutLocker does not like one bit. This does sadly mean that	# pre-Leika client are now sending crap as part of the URL as they	# don't support the | for protocol options.	final_url += "|Referer=" + putlocker_host	#Log(final_url)	ret = []	ret.append(		MediaObject(			parts = [PartObject(key=final_url)],		)	)  	return ret